#!/bin/bash

#
# linux kernel build script.
# by ridobe18 at gmail dot com
#

wrkdir="$HOME/kernel_build/linux"

set -e

#reminders
echo "Don't forget to remove previous kernel from /usr/lib/modules"
sleep 2

#enter build directory
cd "$wrkdir"

#change to working branch
git checkout ridobe-seiei

#Start compilation and immediately answer "yes" to any prompts
make CC=clang HOSTCC=clang -j"$(nproc)" | grep -q "Do you want to build" && echo "yes" | make -j$(nproc)

#make and install modules
make modules_install -j"$(nproc)"

#copy bz image to /boot and rename
cp -v arch/x86_64/boot/bzImage /boot/vmlinuz-ridobe-seiei
echo "New kernel image successfully copied"

#continue on to make initramfs
mkinitcpio -p ridobe-seiei
